<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>DevCenterX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=2.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="../keys.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <script>
        (function() {
            const user = localStorage.getItem('devcenter_user');
            window.isLoggedIn = !!user;
            window.currentPath = window.location.pathname;
            if (window.isLoggedIn) {
                console.log('Usuario detectado desde localStorage:', user);
            }
        })();
    </script>

    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="nav-left">
            <button class="nav-btn dropdown-btn" id="projectDropdown">
                <i class="fas fa-circle" style="font-size: 10px; color: #22c55e;"></i>
                <span id="projectName">HTML, CSS, JS (Static) (1)</span>
                <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
            </button>
            <button class="nav-btn icon-btn" id="editProjectBtn" title="Editar nombre del proyecto">
                <i class="fas fa-pencil-alt"></i>
            </button>
            <div class="project-info-modal" id="projectInfoModal" style="display: none;">
                <div class="project-info-content">
                    <h3 id="modalProjectName">Proyecto</h3>
                    <div class="project-detail"><strong>Iniciales:</strong> <span id="modalInitials">-</span></div>
                    <div class="project-detail"><strong>Tags:</strong> <span id="modalTags">-</span></div>
                    <div class="project-detail"><strong>Descripción:</strong> <p id="modalDescription">-</p></div>
                    <div class="project-detail"><strong>Estado:</strong> <span id="modalStatus" class="status-badge">-</span></div>
                    <div class="project-detail"><strong>Creado:</strong> <span id="modalCreated">-</span></div>
                    <button class="close-modal-btn" onclick="closeProjectInfo()">Cerrar</button>
                </div>
            </div>
            <div class="nav-divider"></div>
            <button class="nav-btn status-btn">
                <i class="fas fa-square" style="color: #3b82f6; font-size: 12px;"></i>
            </button>
            <button class="nav-btn status-btn">
                <i class="fas fa-plus" style="font-size: 12px;"></i>
            </button>
            <button class="upgrade-btn">
                <i class="fas fa-bolt"></i>
                Upgrade
            </button>
        </div>
        <div class="nav-right">
            <button class="nav-btn icon-btn">
                <i class="fas fa-search"></i>
            </button>
            <button class="nav-btn icon-btn">
                <i class="fas fa-star"></i>
            </button>
            <button class="nav-btn icon-btn">
                <i class="fas fa-pen"></i>
            </button>
            <button class="nav-btn icon-btn">
                <i class="fas fa-history"></i>
            </button>
            <button class="nav-btn icon-btn">
                <i class="fas fa-bell"></i>
            </button>
            <button class="devcenter-btn" id="devCenterBtn" title="Share to DevCenterX" style="display: none;">
                <i class="fas fa-cloud-upload-alt" id="devCenterIcon"></i>
                <span id="devCenterBtnText">DevCenterX</span>
            </button>
        </div>
    </div>

    <!-- Secondary Nav Bar -->
    <div class="secondary-nav">
        <div class="file-tabs">
            <button class="file-tab" data-file="preview" id="previewTab">
                <i class="fas fa-eye"></i>
                Preview
                <button class="close-tab">×</button>
            </button>
            <button class="file-tab active" data-file="html">
                <i class="fas fa-file-code"></i>
                index.html
                <span class="new-indicator" style="display: none;"></span>
                <button class="close-tab">×</button>
            </button>
            <button class="file-tab" data-file="js">
                <i class="fab fa-js-square"></i>
                script.js
                <span class="new-indicator" style="display: none;"></span>
                <button class="close-tab">×</button>
            </button>
            <button class="file-tab" data-file="css">
                <i class="fab fa-css3-alt"></i>
                style.css
                <span class="new-indicator" style="display: none;"></span>
                <button class="close-tab">×</button>
            </button>
            <button class="add-tab-btn">+</button>
        </div>
        <div class="secondary-nav-right">
            <button class="nav-btn icon-btn" id="homeBtn" title="Back to home">
                <i class="fas fa-home"></i>
            </button>
            <button class="settings-btn" id="settingsBtn" title="Configuración de guardado">
                <i class="fas fa-cog"></i>
            </button>
            <button class="save-btn" id="saveBtn" title="Guardar proyecto">
                <i class="fas fa-save"></i>
                <span id="saveBtnText">Guardar</span>
            </button>
            <button class="format-btn" id="formatBtn" style="display: none;">
                <i class="fas fa-sync-alt"></i>
                Republicar
            </button>
            <button class="publish-btn" id="publishBtn">
                <i class="fas fa-globe"></i>
                <span id="publishBtnText">Publish</span>
            </button>
        </div>
    
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <div class="settings-panel-content">
                <div class="settings-header">
                    <h3><i class="fas fa-cog"></i> Configuración de Guardado</h3>
                    <button class="close-settings-btn" id="closeSettingsBtn">×</button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <h4><i class="fas fa-laptop"></i> Guardado Local (localStorage)</h4>
                        <div class="settings-option">
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoSaveLocalEnabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Guardado automático en localStorage</span>
                        </div>
                        <div class="settings-option">
                            <label>Intervalo (minutos):</label>
                            <input type="number" id="autoSaveLocalInterval" value="1" min="1" max="60">
                        </div>
                    </div>
                    <div class="settings-section" id="supabaseSettingsSection" style="display: none;">
                        <h4><i class="fas fa-cloud"></i> Guardado en Base de Datos (Supabase)</h4>
                        <div class="settings-option">
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoSaveDbEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Guardado automático en base de datos</span>
                        </div>
                        <div class="settings-option">
                            <label>Intervalo (minutos):</label>
                            <input type="number" id="autoSaveDbInterval" value="3" min="1" max="60">
                        </div>
                    </div>
                </div>
                <div class="settings-footer">
                    <button class="save-settings-btn" id="saveSettingsBtn">
                        <i class="fas fa-check"></i> Guardar Configuración
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar" id="leftSidebar">
            <!-- Chat Header with New Chat Button (hidden initially) -->
            <div class="chat-header-bar" id="chatHeaderBar" style="display: none;">
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i>
                    <span>Nuevo Chat</span>
                </button>
                <div class="chat-status">
                    <i class="fas fa-robot"></i>
                    <span>Agent activo</span>
                </div>
            </div>

            <div class="sidebar-header" id="sidebarHeader">
                <div class="sidebar-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <h3>New chat with Agent</h3>
                <p>Agent can make changes, review its work, and debug itself automatically.</p>
            </div>


            <!-- Chat Messages Area -->
            <div class="chat-messages" id="chatMessages">
            </div>

            <!-- Chat Input Area with Send Button -->
            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" placeholder="Escribe tu mensaje...">
                    <button class="send-btn" id="sendBtn" title="Enviar mensaje">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="chat-input-hint">
                    <span>Presiona Enter para enviar</span>
                </div>
            </div>
        </div>

        <!-- Code Editor & Preview Area -->
        <div class="editor-container">
            <!-- Preview Frame -->
            <div id="previewContainer" class="preview-container" style="display: none;">
                <div class="preview-controls">
                    <button class="preview-control-btn active" data-size="desktop" title="Vista Desktop">
                        <i class="fas fa-desktop"></i>
                    </button>
                    <button class="preview-control-btn" data-size="tablet" title="Vista Tablet">
                        <i class="fas fa-tablet-alt"></i>
                    </button>
                    <button class="preview-control-btn" data-size="mobile" title="Vista Mobile">
                        <i class="fas fa-mobile-alt"></i>
                    </button>
                    <div class="preview-divider"></div>
                    <button class="preview-control-btn" id="zoomOut" title="Zoom Out">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <span class="zoom-indicator" id="zoomLevel">100%</span>
                    <button class="preview-control-btn" id="zoomIn" title="Zoom In">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="preview-control-btn" id="zoomReset" title="Reset Zoom">
                        <i class="fas fa-compress"></i>
                    </button>
                    <div class="preview-divider"></div>
                    <button class="preview-control-btn" id="refreshPreview" title="Refrescar">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="preview-control-btn" id="toggleLogs" title="Consola">
                        <i class="fas fa-terminal"></i>
                        Logs
                    </button>
                    <button class="preview-control-btn" id="fullscreenBtn" title="Pantalla Completa">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="preview-frame-wrapper">
                    <iframe id="previewFrame" class="preview-frame"></iframe>
                </div>
                <div class="console-logs" id="consoleLogs" style="display: none;">
                    <div class="console-header">
                        <span>Console Logs</span>
                        <button class="console-clear" id="clearLogs">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="console-content" id="consoleContent"></div>
                </div>
            </div>

            <!-- Code Editors with Syntax Highlighting -->
            <div id="htmlEditorWrapper" class="editor-wrapper active">
                <pre id="htmlHighlight" class="highlight-layer" aria-hidden="true"><code class="language-html"></code></pre>
                <textarea id="htmlEditor" class="code-editor" spellcheck="false" placeholder="Escribe tu código HTML aquí..."></textarea>
            </div>
            <div id="jsEditorWrapper" class="editor-wrapper">
                <pre id="jsHighlight" class="highlight-layer" aria-hidden="true"><code class="language-javascript"></code></pre>
                <textarea id="jsEditor" class="code-editor" spellcheck="false" placeholder="Escribe tu código JavaScript aquí..."></textarea>
            </div>
            <div id="cssEditorWrapper" class="editor-wrapper">
                <pre id="cssHighlight" class="highlight-layer" aria-hidden="true"><code class="language-css"></code></pre>
                <textarea id="cssEditor" class="code-editor" spellcheck="false" placeholder="Escribe tus estilos CSS aquí..."></textarea>
            </div>
        </div>
    </div>

    <!-- Footer Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <span class="status-item">
                <i class="fab fa-html5"></i>
                HTML
            </span>
            <span class="status-item">
                <i class="fas fa-circle" style="font-size: 8px;"></i>
                0
            </span>
            <span class="status-item">
                <i class="fas fa-exclamation-triangle"></i>
                0
            </span>
        </div>
        <div class="status-right">
            <span class="status-item" id="cursorPosition">Ln 1, Col 1</span>
            <span class="status-item">Spaces: 2</span>
            <span class="status-item">History</span>
            <button class="status-btn">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
